name: Deploy Test

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'deployment environment'
        required: true
        type: choice
        default: ''
        options:
          - Test
          - Production
      tags:
        description: 'tags'
        required: false
        type: choice
        options: []

jobs:
  get-tags:
    runs-on: ubuntu-latest
    steps:
      - run: echo The deployment environment is ${{ inputs.environment }}
      - run: echo The ref is ${{ github.ref }}
      - run: echo The ref_type is ${{ github.ref_type }}
      - run: echo The ref_name is ${{ github.ref_name }}

      - name: Deploy environment
        if: (github.ref_type != 'tag') || (!startsWith(github.ref_name, "test@"))
        run: echo "::error::Please select a valid tag"

  build-test:
    needs: get-tags
    if: github.ref_type == 'tag' && startsWith(github.ref_name, 'test@') && inputs.environment == 'Test'
    runs-on: ubuntu-latest
    steps:
      - run: echo npm run build:test

  build:
    needs: get-tags
    if: github.ref_type == 'tag' && startsWith(github.ref_name, 'test@') && inputs.environment == 'Production'
    runs-on: ubuntu-latest
    steps:
      - run: echo npm run build
